<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <title>Spinnaker Managed: EnumerationEvents_CSharp.cs</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="ga.js"></script>
  <link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
  <div id="top"><!-- do not remove this div! -->
  <div id="titlearea">
    <table cellspacing="0" cellpadding="0.9em" width="100%">
      <tbody>
        <tr style="height: 56px;">
          <td id="projectlogo" style="padding-left: 0.9em;text-align: left;background: #ffffff;background: linear-gradient(#002f86, #ffffff);color: #ffffff;" width="30%"><a href="https://www.flir.com/iis/machine-vision"><img alt="Logo" src="FLIR_Logo.png"/></a></td>
          <td style="padding-left: 0.5em;text-align: left;background: #002f86;background: linear-gradient(#002f86, #ffffff);color: #ffffff;" width="30%"><div id="projectname">Spinnaker Managed</div></td>
          <td style="padding-right: 0.9em;text-align: right;background: #002f86;background: linear-gradient(#002f86, #ffffff);color: #ffffff;" width="30%"><div id="projectname"><span id="projectnumber">2.0.0.0</span></td>
        </tr>
      </tbody>
    </table>
  </div>
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">EnumerationEvents_CSharp.cs</div>  </div>
</div><!--header-->
<div class="contents">
<p>EnumerationEvents_CSharp.cs explores arrival and removal events on interfaces and the system. It relies on information provided in the <a class="el" href="namespace_enumeration___c_sharp.html">Enumeration_CSharp</a>, <a class="el" href="namespace_acquisition___c_sharp.html">Acquisition_CSharp</a>, and <a class="el" href="namespace_node_map_info___c_sharp.html">NodeMapInfo_CSharp</a> examples.</p>
<p>It can also be helpful to familiarize yourself with the <a class="el" href="namespace_node_map_callback___c_sharp.html">NodeMapCallback_CSharp</a> example, as nodemap callbacks follow the same general procedure as events, but with a few less steps.</p>
<p>This example creates a user-defined class, InterfaceEventListener. It allows the user to define any properties, parameters, and the event itself while the parent class, ManagedInterfaceEventHandler, allows the child class to interface with the Spinnaker SDK.</p>
<div class="fragment"><div class="line"><span class="comment">//=============================================================================</span></div>
<div class="line"><span class="comment">// Copyright (c) 2001-2019 FLIR Systems, Inc. All Rights Reserved.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This software is the confidential and proprietary information of FLIR</span></div>
<div class="line"><span class="comment">// Integrated Imaging Solutions, Inc. (&quot;Confidential Information&quot;). You</span></div>
<div class="line"><span class="comment">// shall not disclose such Confidential Information and shall use it only in</span></div>
<div class="line"><span class="comment">// accordance with the terms of the license agreement you entered into</span></div>
<div class="line"><span class="comment">// with FLIR Integrated Imaging Solutions, Inc. (FLIR).</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// FLIR MAKES NO REPRESENTATIONS OR WARRANTIES ABOUT THE SUITABILITY OF THE</span></div>
<div class="line"><span class="comment">// SOFTWARE, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE</span></div>
<div class="line"><span class="comment">// IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR</span></div>
<div class="line"><span class="comment">// PURPOSE, OR NON-INFRINGEMENT. FLIR SHALL NOT BE LIABLE FOR ANY DAMAGES</span></div>
<div class="line"><span class="comment">// SUFFERED BY LICENSEE AS A RESULT OF USING, MODIFYING OR DISTRIBUTING</span></div>
<div class="line"><span class="comment">// THIS SOFTWARE OR ITS DERIVATIVES.</span></div>
<div class="line"><span class="comment">//=============================================================================</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> System;</div>
<div class="line"><span class="keyword">using</span> System.Collections.Generic;</div>
<div class="line"><span class="keyword">using</span> SpinnakerNET;</div>
<div class="line"><span class="keyword">using</span> SpinnakerNET.GenApi;</div>
<div class="line"><span class="keyword">using</span> System.Threading;</div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>EnumerationEvents_CSharp</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">class </span>Program</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// This class defines the properties and methods for device arrivals and removals</span></div>
<div class="line">        <span class="comment">// on an interface. Take special note of the signatures of the OnDeviceArrival()</span></div>
<div class="line">        <span class="comment">// and OnDeviceRemoval() methods. Also, enumeration event listeners must inherit</span></div>
<div class="line">        <span class="comment">// from ManagedInterfaceEventHandler whether they are to be registered to the system</span></div>
<div class="line">        <span class="comment">// or an interface.</span></div>
<div class="line">        <span class="keyword">class </span>InterfaceEventListener : ManagedInterfaceEventHandler</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">private</span> <span class="keywordtype">bool</span> registerToSystem;</div>
<div class="line">            <span class="keyword">private</span> <span class="keywordtype">string</span> interfaceID;</div>
<div class="line">            <span class="keyword">private</span> IManagedInterface managedInterface;</div>
<div class="line">            <span class="keyword">private</span> IManagedSystem managedSystem;</div>
<div class="line"></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// Set the constructor</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// *** NOTES ***</span></div>
<div class="line">            <span class="comment">// When constructing a generic InterfaceEventListener to be registered to the system,</span></div>
<div class="line">            <span class="comment">// the handler will not have knowledge of which interface triggered the event callbacks.</span></div>
<div class="line">            <span class="comment">// On the other hand, InterfaceEventListener does not need knowledge about the system if we</span></div>
<div class="line">            <span class="comment">// are constructing it to be registered to a specific interface.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="keyword">public</span> InterfaceEventListener(<span class="keywordtype">string</span> ifaceID, IManagedInterface manIface)</div>
<div class="line">            {</div>
<div class="line">                interfaceID = ifaceID;</div>
<div class="line">                managedInterface = manIface;</div>
<div class="line">                registerToSystem = <span class="keyword">false</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keyword">public</span> InterfaceEventListener(IManagedSystem manSystem)</div>
<div class="line">            {</div>
<div class="line">                managedSystem = manSystem;</div>
<div class="line">                registerToSystem = <span class="keyword">true</span>;</div>
<div class="line">                interfaceID = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// This method defines the arrival event callback on an interface. It prints out</span></div>
<div class="line">            <span class="comment">// the device serial number of the camera arriving and the interface ID.</span></div>
<div class="line">            <span class="comment">// The argument is the serial number of the camera that triggered the arrival event.</span></div>
<div class="line">            <span class="comment">// If the event handler was constructed to be registered to the system as a generic</span></div>
<div class="line">            <span class="comment">// InterfaceEventListener, then we just retrieve the number of cameras</span></div>
<div class="line">            <span class="comment">// currently connected on the system and print it out.</span></div>
<div class="line">            <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnDeviceArrival(UInt64 serialNumber)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (registerToSystem)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordtype">int</span> deviceCount = managedSystem.GetCameras().Count;</div>
<div class="line">                    PrintGenericHandlerMessage(deviceCount);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    Console.WriteLine(<span class="stringliteral">&quot;Interface event listener:&quot;</span>);</div>
<div class="line">                    Console.WriteLine(<span class="stringliteral">&quot;\tDevice {0} has arrived on interface {1}.\n&quot;</span>, serialNumber, interfaceID);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// This method defines the removal event callback on an interface. It prints out the</span></div>
<div class="line">            <span class="comment">// device serial number of the camera being removed and the interface ID.</span></div>
<div class="line">            <span class="comment">// The argument is the serial number of the camera that triggered the removal event.</span></div>
<div class="line">            <span class="comment">// If the event handler was constructed to be registered to the system as a generic</span></div>
<div class="line">            <span class="comment">// InterfaceEventListener, then we just retrieve the number of cameras</span></div>
<div class="line">            <span class="comment">// currently connected on the system and print it out.</span></div>
<div class="line">            <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnDeviceRemoval(UInt64 serialNumber)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (registerToSystem)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordtype">int</span> deviceCount = managedSystem.GetCameras().Count;</div>
<div class="line">                    PrintGenericHandlerMessage(deviceCount);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    Console.WriteLine(<span class="stringliteral">&quot;Interface event listener:&quot;</span>);</div>
<div class="line">                    Console.WriteLine(<span class="stringliteral">&quot;\tDevice {0} was removed from interface {1}.\n&quot;</span>, serialNumber, interfaceID);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Helper function to print the number of devices on an interface event registered to the system.</span></div>
<div class="line">            <span class="keyword">private</span> <span class="keywordtype">void</span> PrintGenericHandlerMessage(<span class="keywordtype">int</span> deviceCount)</div>
<div class="line">            {</div>
<div class="line">                Console.WriteLine(<span class="stringliteral">&quot;Generic interface event handler:&quot;</span>);</div>
<div class="line">                <span class="keywordtype">bool</span> singular = deviceCount == 1;</div>
<div class="line">                Console.WriteLine(</div>
<div class="line">                    <span class="stringliteral">&quot;\tThere {0} {1} {2} on the system.\n&quot;</span>,</div>
<div class="line">                    (singular ? <span class="stringliteral">&quot;is&quot;</span></div>
<div class="line">                     : <span class="stringliteral">&quot;are&quot;</span>),</div>
<div class="line">                    deviceCount,</div>
<div class="line">                    (singular ? <span class="stringliteral">&quot;device&quot;</span></div>
<div class="line">                     : <span class="stringliteral">&quot;devices&quot;</span>));</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// This method returns the interface ID that the interface event handler is bound to.</span></div>
<div class="line">            <span class="keyword">public</span> <span class="keywordtype">string</span> GetInterfaceId()</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">return</span> interfaceID;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// This class defines the properties and methods of the system event listener that handles</span></div>
<div class="line">        <span class="comment">// interface arrival and removal events on the system. Take special note of the signatures</span></div>
<div class="line">        <span class="comment">// of the OnInterfaceArrival() and OnInterfaceRemoval() methods.</span></div>
<div class="line">        <span class="comment">// Interface enumeration event handlers must inherit from ManagedSystemEventHandler.</span></div>
<div class="line">        <span class="keyword">class </span>SystemEventListener : ManagedSystemEventHandler</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">private</span> ManagedSystem system;</div>
<div class="line">            <span class="keyword">private</span> readonly Mutex eventListenersMutex;</div>
<div class="line">            <span class="keyword">private</span> List&lt;InterfaceEventListener&gt;interfaceEventListeners;</div>
<div class="line">            <span class="keyword">private</span> InterfaceEventListener interfaceEventListenerOnSystem;</div>
<div class="line"></div>
<div class="line">            <span class="keyword">public</span> SystemEventListener(ManagedSystem sys)</div>
<div class="line">            {</div>
<div class="line">                system = sys;</div>
<div class="line">                eventListenersMutex = <span class="keyword">new</span> Mutex();</div>
<div class="line">                interfaceEventListeners = <span class="keyword">new</span> List&lt;InterfaceEventListener&gt;();</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// This method defines the interface arrival event callback on the system.</span></div>
<div class="line">            <span class="comment">// It first prints the ID of the arriving interface, then</span></div>
<div class="line">            <span class="comment">// registers the interface event on the newly arrived interface.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// *** NOTES ***</span></div>
<div class="line">            <span class="comment">// Only arrival events for GEV interfaces are currently supported.</span></div>
<div class="line">            <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnInterfaceArrival(<span class="keywordtype">string</span> interfaceID)</div>
<div class="line">            {</div>
<div class="line">                Console.WriteLine(<span class="stringliteral">&quot;System event handler:&quot;</span>);</div>
<div class="line">                Console.WriteLine(<span class="stringliteral">&quot;\tInterface &#39;{0}&#39; has arrived on the system.\n&quot;</span>, interfaceID);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// UpdateInterfaceList() only updates newly arrived or newly removed interfaces.</span></div>
<div class="line">                <span class="comment">// In particular, after this call:</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// - Any pre-existing interfaces will still be valid.</span></div>
<div class="line">                <span class="comment">// - Newly removed interfaces will be invalid.</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// *** NOTES ***</span></div>
<div class="line">                <span class="comment">// - Invalid interfaces will be re-validated if the interface comes back (arrives) with the same</span></div>
<div class="line">                <span class="comment">// interface ID. If the interface ID changes, you must get the new interface object from the updated</span></div>
<div class="line">                <span class="comment">// interface list in order to access this interface.</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// - Interface indices used to access an interface with GetInterfaces() may change after updating the</span></div>
<div class="line">                <span class="comment">// interface list. The interface at a particular index cannot be expected to remain at that index after</span></div>
<div class="line">                <span class="comment">// calling UpdateInterfaceList().</span></div>
<div class="line">                system.UpdateInterfaceList();</div>
<div class="line"></div>
<div class="line">                ManagedInterfaceList interfaceList = system.GetInterfaces();</div>
<div class="line">                <span class="keywordtype">int</span> numInterfaces = interfaceList.Count;</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Here we go through the new interface list to find the arrived interface</span></div>
<div class="line">                <span class="comment">// and display the cameras connected to the new interface.</span></div>
<div class="line">                <span class="keywordflow">for</span> (uint ifaceIdx = 0; ifaceIdx &lt; numInterfaces; ifaceIdx++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// Select interface</span></div>
<div class="line">                    IManagedInterface manInterface = interfaceList.GetByIndex(ifaceIdx);</div>
<div class="line">                    INodeMap nodeMap = manInterface.GetTLNodeMap();</div>
<div class="line"></div>
<div class="line">                    IString interfaceIDNode = nodeMap.GetNode&lt;IString&gt;(<span class="stringliteral">&quot;InterfaceID&quot;</span>);</div>
<div class="line">                    <span class="comment">// Ensure the node is valid</span></div>
<div class="line">                    <span class="keywordflow">if</span> (interfaceIDNode == null || !interfaceIDNode.IsReadable)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">continue</span>;</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                    <span class="keywordflow">if</span> (interfaceIDNode.Value != interfaceID)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">continue</span>;</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                    ManagedCameraList cameraList = manInterface.GetCameras();</div>
<div class="line">                    <span class="keywordtype">int</span> numCameras = cameraList.Count;</div>
<div class="line">                    <span class="keywordflow">for</span> (uint camIdx = 0; camIdx &lt; numCameras; camIdx++)</div>
<div class="line">                    {</div>
<div class="line">                        IManagedCamera manCamera = cameraList.GetByIndex(camIdx);</div>
<div class="line">                        INodeMap nodeMapTLDevice = manCamera.GetTLDeviceNodeMap();</div>
<div class="line">                        IString deviceSerialNode = nodeMapTLDevice.GetNode&lt;IString&gt;(<span class="stringliteral">&quot;DeviceSerialNumber&quot;</span>);</div>
<div class="line">                        <span class="keywordflow">if</span> (deviceSerialNode != null &amp;&amp; deviceSerialNode.IsReadable)</div>
<div class="line">                        {</div>
<div class="line">                            <span class="keywordtype">string</span> deviceSerialNumber = deviceSerialNode.Value;</div>
<div class="line">                            Console.WriteLine(</div>
<div class="line">                                <span class="stringliteral">&quot;\tDevice {0} is connected to interface &#39;{1}&#39;.&quot;</span>, deviceSerialNumber, interfaceID);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                    <span class="comment">// Create interface event</span></div>
<div class="line">                    {</div>
<div class="line">                        eventListenersMutex.WaitOne();</div>
<div class="line"></div>
<div class="line">                        <span class="keywordflow">try</span></div>
<div class="line">                        {</div>
<div class="line">                            InterfaceEventListener interfaceEventListener =</div>
<div class="line">                                <span class="keyword">new</span> InterfaceEventListener(interfaceID, manInterface);</div>
<div class="line">                            interfaceEventListeners.Add(interfaceEventListener);</div>
<div class="line"></div>
<div class="line">                            <span class="comment">// Register interface event listener</span></div>
<div class="line">                            manInterface.RegisterEventHandler(interfaceEventListener);</div>
<div class="line">                            Console.WriteLine(<span class="stringliteral">&quot;Event handler registered to interface &#39;{0}&#39;...\n&quot;</span>, interfaceID);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">catch</span> (Exception ex)</div>
<div class="line">                        {</div>
<div class="line">                            Console.WriteLine(</div>
<div class="line">                                <span class="stringliteral">&quot;Error registering interface event handler to &#39;{0}&#39;: {1}&quot;</span>, interfaceID, ex.Message);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">finally</span></div>
<div class="line">                        {</div>
<div class="line">                            eventListenersMutex.ReleaseMutex();</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// This method defines the interface removal event callback on the system.</span></div>
<div class="line">            <span class="comment">// It prints the ID of the interface removed.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// *** NOTES ***</span></div>
<div class="line">            <span class="comment">// Only removal events for GEV interfaces are currently supported.</span></div>
<div class="line">            <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> OnInterfaceRemoval(<span class="keywordtype">string</span> interfaceID)</div>
<div class="line">            {</div>
<div class="line">                Console.WriteLine(<span class="stringliteral">&quot;System event handler:&quot;</span>);</div>
<div class="line">                Console.WriteLine(<span class="stringliteral">&quot;\tInterface &#39;{0}&#39; was removed from the system.\n&quot;</span>, interfaceID);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Interface indices used to access an interface with GetInterfaces() may change after updating the</span></div>
<div class="line">                <span class="comment">// interface list. The interface at a particular index cannot be expected to remain at that index after</span></div>
<div class="line">                <span class="comment">// calling UpdateInterfaceList().</span></div>
<div class="line">                system.UpdateInterfaceList();</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Find the event handler that was registered to the removed interface and remove it.</span></div>
<div class="line">                <span class="comment">// Interface event handlers are automatically unregistered when the interface is removed so it is not</span></div>
<div class="line">                <span class="comment">// necessary to manually unregister them.</span></div>
<div class="line">                {</div>
<div class="line">                    eventListenersMutex.WaitOne();</div>
<div class="line">                    <span class="keywordflow">try</span></div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordtype">int</span> handlerIdx = 0;</div>
<div class="line">                        <span class="keywordflow">for</span> (handlerIdx = 0; handlerIdx &lt; interfaceEventListeners.Count; handlerIdx++)</div>
<div class="line">                        {</div>
<div class="line">                            <span class="keywordflow">if</span> (interfaceEventListeners[handlerIdx].GetInterfaceId() == interfaceID)</div>
<div class="line">                            {</div>
<div class="line">                                interfaceEventListeners.RemoveAt(handlerIdx);</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                            }</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">catch</span> (Exception ex)</div>
<div class="line">                    {</div>
<div class="line">                        Console.WriteLine(</div>
<div class="line">                            <span class="stringliteral">&quot;Error erasing event hander from interface &#39;{0}&#39;: {1}&quot;</span>, interfaceID, ex.Message);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">finally</span></div>
<div class="line">                    {</div>
<div class="line">                        eventListenersMutex.ReleaseMutex();</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> RegisterInterfaceEventToSystem()</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (interfaceEventListenerOnSystem == null)</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">//</span></div>
<div class="line">                    <span class="comment">// Create interface event listener for the system</span></div>
<div class="line">                    <span class="comment">//</span></div>
<div class="line">                    <span class="comment">// *** NOTES ***</span></div>
<div class="line">                    <span class="comment">// The InterfaceEventListener has been constructed to accept a system object in</span></div>
<div class="line">                    <span class="comment">// order to print the number of cameras on the system.</span></div>
<div class="line">                    <span class="comment">//</span></div>
<div class="line">                    interfaceEventListenerOnSystem = <span class="keyword">new</span> InterfaceEventListener(system);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// Register interface event handler for the system</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// *** NOTES ***</span></div>
<div class="line">                <span class="comment">// Arrival, removal, and interface event handlers can all be registered to</span></div>
<div class="line">                <span class="comment">// interfaces or the system. Do not think that interface event handlers can only be</span></div>
<div class="line">                <span class="comment">// registered to an interface. An interface event is merely a combination</span></div>
<div class="line">                <span class="comment">// of an arrival and a removal event.</span></div>
<div class="line">                <span class="comment">// Only arrival and removal events for GEV interfaces are currently supported.</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// *** LATER ***</span></div>
<div class="line">                <span class="comment">// Arrival, removal, and interface event handlers must all be unregistered manually.</span></div>
<div class="line">                <span class="comment">// This must be done prior to releasing the system and while they are still</span></div>
<div class="line">                <span class="comment">// in scope.</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                system.RegisterInterfaceEventHandler(interfaceEventListenerOnSystem);</div>
<div class="line">                Console.WriteLine(<span class="stringliteral">&quot;Interface event handler registered on the system...&quot;</span>);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> UnregisterInterfaceEventFromSystem()</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// Unregister interface event handler from system object</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// *** NOTES ***</span></div>
<div class="line">                <span class="comment">// It is important to unregister all arrival, removal, and interface event handlers</span></div>
<div class="line">                <span class="comment">// registered to the system.</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="keywordflow">if</span> (interfaceEventListenerOnSystem != null)</div>
<div class="line">                {</div>
<div class="line">                    system.UnregisterInterfaceEventHandler(interfaceEventListenerOnSystem);</div>
<div class="line">                    Console.WriteLine(<span class="stringliteral">&quot;Interface event handler unregistered from system...&quot;</span>);</div>
<div class="line">                    interfaceEventListenerOnSystem = null;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> RegisterAllInterfaceEvents()</div>
<div class="line">            {</div>
<div class="line">                {</div>
<div class="line">                    eventListenersMutex.WaitOne();</div>
<div class="line"></div>
<div class="line">                    <span class="keywordflow">if</span> (interfaceEventListeners.Count != 0)</div>
<div class="line">                    {</div>
<div class="line">                        interfaceEventListeners.Clear();</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                    eventListenersMutex.ReleaseMutex();</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                ManagedInterfaceList interfaceList = system.GetInterfaces();</div>
<div class="line">                <span class="keywordtype">int</span> numInterfaces = interfaceList.Count;</div>
<div class="line"></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// Create and register interface event handler to each interface</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// *** NOTES ***</span></div>
<div class="line">                <span class="comment">// The process of event handler creation and registration on interfaces is similar</span></div>
<div class="line">                <span class="comment">// to the process of event handler creation and registration on the system. The</span></div>
<div class="line">                <span class="comment">// InterfaceEventListener class has been written to accept an interface and an</span></div>
<div class="line">                <span class="comment">// interface ID to differetiate between the interfaces.</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// *** LATER ***</span></div>
<div class="line">                <span class="comment">// Arrival, removal, and interface event handlers must all be unregistered manually.</span></div>
<div class="line">                <span class="comment">// This must be done prior to releasing the system and while they are still</span></div>
<div class="line">                <span class="comment">// in scope.</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="keywordflow">for</span> (uint i = 0; i &lt; numInterfaces; i++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// Select interface</span></div>
<div class="line">                    IManagedInterface manInterface = interfaceList.GetByIndex(i);</div>
<div class="line">                    INodeMap nodeMap = manInterface.GetTLNodeMap();</div>
<div class="line"></div>
<div class="line">                    IString interfaceIDNode = nodeMap.GetNode&lt;IString&gt;(<span class="stringliteral">&quot;InterfaceID&quot;</span>);</div>
<div class="line">                    <span class="comment">// Ensure the node is valid</span></div>
<div class="line">                    <span class="keywordflow">if</span> (interfaceIDNode == null || !interfaceIDNode.IsReadable)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">continue</span>;</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                    <span class="keywordtype">string</span> interfaceID = interfaceIDNode.Value;</div>
<div class="line"></div>
<div class="line">                    {</div>
<div class="line">                        eventListenersMutex.WaitOne();</div>
<div class="line">                        <span class="keywordflow">try</span></div>
<div class="line">                        {</div>
<div class="line">                            <span class="comment">// Create interface event handler</span></div>
<div class="line">                            InterfaceEventListener interfaceEventListener =</div>
<div class="line">                                <span class="keyword">new</span> InterfaceEventListener(interfaceID, manInterface);</div>
<div class="line">                            interfaceEventListeners.Add(interfaceEventListener);</div>
<div class="line"></div>
<div class="line">                            <span class="comment">// Register interface event handler</span></div>
<div class="line">                            manInterface.RegisterEventHandler(interfaceEventListener);</div>
<div class="line"></div>
<div class="line">                            Console.WriteLine(<span class="stringliteral">&quot;Event handler registered to interface &#39;{0}&#39;...&quot;</span>, interfaceID);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">catch</span> (Exception ex)</div>
<div class="line">                        {</div>
<div class="line">                            Console.WriteLine(</div>
<div class="line">                                <span class="stringliteral">&quot;Error erasing event hander from interface &#39;{0}&#39;: {1}&quot;</span>, interfaceID, ex.Message);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">finally</span></div>
<div class="line">                        {</div>
<div class="line">                            eventListenersMutex.ReleaseMutex();</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                Console.WriteLine();</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> UnregisterAllInterfaceEvents()</div>
<div class="line">            {</div>
<div class="line">                ManagedInterfaceList interfaceList = system.GetInterfaces(<span class="keyword">false</span>);</div>
<div class="line">                <span class="keywordtype">int</span> numInterfaces = interfaceList.Count;</div>
<div class="line"></div>
<div class="line">                eventListenersMutex.WaitOne();</div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// Unregister interface event handler from each interface</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="comment">// *** NOTES ***</span></div>
<div class="line">                <span class="comment">// It is important to unregister all arrival, removal, and interface event handlers</span></div>
<div class="line">                <span class="comment">// from all interfaces that they may be registered to.</span></div>
<div class="line">                <span class="comment">//</span></div>
<div class="line">                <span class="keywordflow">for</span> (uint i = 0; i &lt; numInterfaces; i++)</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// Select interface</span></div>
<div class="line">                    IManagedInterface manInterface = interfaceList.GetByIndex(i);</div>
<div class="line">                    INodeMap nodeMap = manInterface.GetTLNodeMap();</div>
<div class="line"></div>
<div class="line">                    IString interfaceIDNode = nodeMap.GetNode&lt;IString&gt;(<span class="stringliteral">&quot;InterfaceID&quot;</span>);</div>
<div class="line">                    <span class="comment">// Ensure the node is valid</span></div>
<div class="line">                    <span class="keywordflow">if</span> (interfaceIDNode == null || !interfaceIDNode.IsReadable)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">continue</span>;</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                    <span class="keywordtype">string</span> interfaceID = interfaceIDNode.Value;</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">try</span></div>
<div class="line">                        {</div>
<div class="line">                            <span class="keywordflow">foreach</span>(InterfaceEventListener listener <span class="keywordflow">in</span> interfaceEventListeners)</div>
<div class="line">                            {</div>
<div class="line">                                <span class="keywordflow">if</span> (interfaceID == listener.GetInterfaceId())</div>
<div class="line">                                {</div>
<div class="line">                                    manInterface.UnregisterEventHandler(listener);</div>
<div class="line">                                }</div>
<div class="line">                            }</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">catch</span> (Exception ex)</div>
<div class="line">                        {</div>
<div class="line">                            Console.WriteLine(</div>
<div class="line">                                <span class="stringliteral">&quot;Error erasing event hander from interface &#39;{0}&#39;: {1}&quot;</span>, interfaceID, ex.Message);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                interfaceEventListeners.Clear();</div>
<div class="line">                Console.WriteLine(<span class="stringliteral">&quot;Event handler unregistered from interfaces...&quot;</span>);</div>
<div class="line">                eventListenersMutex.ReleaseMutex();</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// This function checks if GEV enumeration is enabled on the system.</span></div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">void</span> CheckGevEnabled(ManagedSystem pSystem)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Retrieve the System TL Nodemap and EnumerateGEVInterfaces node.</span></div>
<div class="line">            INodeMap nodeMapTLSystem = pSystem.GetTLNodeMap();</div>
<div class="line">            IBool enumerateGevInterfacesNode = nodeMapTLSystem.GetNode&lt;IBool&gt;(<span class="stringliteral">&quot;EnumerateGEVInterfaces&quot;</span>);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Ensure the node is valid.</span></div>
<div class="line">            <span class="keywordflow">if</span> (enumerateGevInterfacesNode != null &amp;&amp; enumerateGevInterfacesNode.IsReadable)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">bool</span> gevEnabled = enumerateGevInterfacesNode.Value;</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Check if node is enabled.</span></div>
<div class="line">                <span class="keywordflow">if</span> (!gevEnabled)</div>
<div class="line">                {</div>
<div class="line">                    Console.WriteLine(<span class="stringliteral">&quot;\nWARNING: GEV Enumeration is disabled.&quot;</span>);</div>
<div class="line">                    Console.WriteLine(<span class="stringliteral">&quot;If you intend to use GigE cameras please run the EnableGEVInterfaces shortcut&quot;</span>);</div>
<div class="line">                    Console.WriteLine(<span class="stringliteral">&quot;or set EnumerateGEVInterfaces to true and relaunch your application.\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                Console.WriteLine(<span class="stringliteral">&quot;EnumerateGEVInterfaces node is unavailable&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;EnumerateGEVInterfaces is enabled. Continuing..&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Example entry point; this function sets up the example to act</span></div>
<div class="line">        <span class="comment">// appropriately upon arrival and removal events; please see</span></div>
<div class="line">        <span class="comment">// Enumeration_CSharp example for more in-depth comments on</span></div>
<div class="line">        <span class="comment">// preparing and cleaning up the system.</span></div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">int</span> Main(<span class="keywordtype">string</span>[] args)</div>
<div class="line">        {</div>
<div class="line">            Program program = <span class="keyword">new</span> Program();</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Retrieve singleton reference to system object</span></div>
<div class="line">            ManagedSystem system = <span class="keyword">new</span> ManagedSystem();</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Print out current library version</span></div>
<div class="line">            LibraryVersion spinVersion = system.GetLibraryVersion();</div>
<div class="line">            Console.WriteLine(</div>
<div class="line">                <span class="stringliteral">&quot;Spinnaker library version: {0}.{1}.{2}.{3}\n\n&quot;</span>,</div>
<div class="line">                spinVersion.major,</div>
<div class="line">                spinVersion.minor,</div>
<div class="line">                spinVersion.type,</div>
<div class="line">                spinVersion.build);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Check if GEV enumeration is enabled</span></div>
<div class="line">            CheckGevEnabled(system);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Retrieve list of cameras from the system</span></div>
<div class="line">            ManagedCameraList camList = system.GetCameras();</div>
<div class="line"></div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;Number of cameras detected: {0}\n&quot;</span>, camList.Count);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Retrieve list of interfaces from the system</span></div>
<div class="line">            ManagedInterfaceList interfaceList = system.GetInterfaces();</div>
<div class="line"></div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;Number of interfaces detected: {0}\n&quot;</span>, interfaceList.Count);</div>
<div class="line"></div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;\n*** CONFIGURING ENUMERATION EVENTS ***\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// Create system event listener</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// *** NOTES ***</span></div>
<div class="line">            <span class="comment">// The SystemEventListener has been written to accept a system object in</span></div>
<div class="line">            <span class="comment">// the constructor in order to register/unregister events to/from the system object</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            SystemEventListener systemEventListener = <span class="keyword">new</span> SystemEventListener(system);</div>
<div class="line"></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// Register system event to the system</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// *** NOTES ***</span></div>
<div class="line">            <span class="comment">// A system event is merely a combination of an interface arrival and an</span></div>
<div class="line">            <span class="comment">// interface removal event.</span></div>
<div class="line">            <span class="comment">// This feature is currently only supported for GEV interface arrivals and removals.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// *** LATER ***</span></div>
<div class="line">            <span class="comment">// Interface arrival and removal events must all be unregistered manually.</span></div>
<div class="line">            <span class="comment">// This must be done prior to releasing the system and while they are still</span></div>
<div class="line">            <span class="comment">// in scope.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            system.RegisterEventHandler(systemEventListener);</div>
<div class="line"></div>
<div class="line">            systemEventListener.RegisterInterfaceEventToSystem();</div>
<div class="line">            systemEventListener.RegisterAllInterfaceEvents();</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Wait for user to plug in and/or remove camera devices</span></div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;\nReady! Remove/Plug in cameras to test or press Enter to exit...\n&quot;</span>);</div>
<div class="line">            Console.ReadLine();</div>
<div class="line"></div>
<div class="line">            systemEventListener.UnregisterAllInterfaceEvents();</div>
<div class="line">            systemEventListener.UnregisterInterfaceEventFromSystem();</div>
<div class="line"></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// Unregister system event handler from system object</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// *** NOTES ***</span></div>
<div class="line">            <span class="comment">// It is important to unregister all interface arrival and removal event handlers</span></div>
<div class="line">            <span class="comment">// registered to the system.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            system.UnregisterEventHandler(systemEventListener);</div>
<div class="line"></div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;System event handler unregistered from system...&quot;</span>);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Clear camera list before releasing system</span></div>
<div class="line">            camList.Clear();</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Clear interface list before releasing system</span></div>
<div class="line">            interfaceList.Clear();</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Release system</span></div>
<div class="line">            system.Dispose();</div>
<div class="line"></div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;\nDone! Press Enter to exit...&quot;</span>);</div>
<div class="line">            Console.ReadLine();</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->

  <table style="width: 100%;border-spacing: 0px 0px;border-left-style: solid;border-left-width: ;border-left-color: #8c8888;border-right-style: solid;border-right-width: ;border-right-color: #8c8888;border-top-style: solid;border-top-width: ;border-top-color: #8c8888;border-bottom-style: solid;border-bottom-width: ;border-bottom-color: #8c8888;margin-left: 0;margin-right: auto;padding: 0px">
    <col />
    <col />
    <col />
        <tbody>
            <tr>
                <td style="background-color: #8c8888;color: #ffffff;"><a class="footer" href="https://www.flir.com/support-center/rma/iis-support-request">Contact Support </a> </td>
                <td style="background-color: #8c8888;color: #ffffff;text-align: center;font-size: 16px;font-weight: bold">Spinnaker&#174; SDK Programmer's Guide and API Reference</td>
                <td style="background-color: #8c8888;color: #ffffff;text-align: right;"><address class="footer">
Wed Sep 30 2020 &#160; <a class="footer" href="https://www.flir.com/iis/machine-vision">FLIR Integrated Imaging Solutions Inc. All rights reserved.</a></address></td>
            </tr>
        </tbody>
  </table>
</body>
</html>
